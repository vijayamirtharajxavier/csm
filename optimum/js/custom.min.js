//var base_url = $("#base_url").val();
var base_url = $("#base_url").val();
//console.log(base_url);

var manageDemandTable;

$(document).ready(function(){
	"use strict";var e=$("body");$(function(){$(".preloader").fadeOut(),$("#side-menu").metisMenu()}),$(".right-side-toggle").on("click",function(){$(".right-sidebar").slideDown(50).toggleClass("shw-rside"),$(".fxhdr").on("click",function(){e.toggleClass("fix-header")}),$(".fxsdr").on("click",function(){e.toggleClass("fix-sidebar")});var i=$(".fxhdr");e.hasClass("fix-header")?i.attr("checked",!0):i.attr("checked",!1),e.hasClass("fix-sidebar")?i.attr("checked",!0):i.attr("checked",!1)}),$(function(){var i=function(){var i=60,s=window.innerWidth>0?window.innerWidth:this.screen.width,l=(window.innerHeight>0?window.innerHeight:this.screen.height)-1;768>s?($("div.navbar-collapse").addClass("collapse"),i=100):$("div.navbar-collapse").removeClass("collapse"),1170>s?(e.addClass("content-wrapper"),$(".open-close i").removeClass("icon-arrow-left-circle"),$(".sidebar-nav, .slimScrollDiv").css("overflow-x","visible").parent().css("overflow","visible"),$(".logo span").hide()):(e.removeClass("content-wrapper"),$(".open-close i").addClass("icon-arrow-left-circle"),$(".logo span").show()),l-=i,1>l&&(l=1),l>i&&$("#page-wrapper").css("min-height",l+"px")},s=window.location,l=$("ul.nav a").filter(function(){return this.href===s||0===s.href.indexOf(this.href)}).addClass("active").parent().parent().addClass("in").parent();l.is("li")&&l.addClass("active"),$(window).ready(i),$(window).on("resize",i)}),$(".open-close").on("click",function(){$("body").hasClass("content-wrapper")?($("body").trigger("resize"),$(".sidebar-nav, .slimScrollDiv").css("overflow","hidden").parent().css("overflow","visible"),$("body").removeClass("content-wrapper"),$(".open-close i").addClass("icon-arrow-left-circle"),$(".logo span").show()):($("body").trigger("resize"),$(".sidebar-nav, .slimScrollDiv").css("overflow-x","visible").parent().css("overflow","visible"),$("body").addClass("content-wrapper"),$(".open-close i").removeClass("icon-arrow-left-circle"),$(".logo span").hide())}),function(e,i,s){var l='[data-perform="panel-collapse"]',o='[data-perform="panel-dismiss"]';e(l).each(function(){var i={toggle:!1},s=e(this).closest(".panel"),l=s.find(".panel-wrapper"),o=e(this).children("i");l.length||(l=s.children(".panel-heading").nextAll().wrapAll("<div/>").parent().addClass("panel-wrapper"),i={}),l.collapse(i).on("hide.bs.collapse",function(){o.removeClass("ti-minus").addClass("ti-plus")}).on("show.bs.collapse",function(){o.removeClass("ti-plus").addClass("ti-minus")})}),e(s).on("click",l,function(i){i.preventDefault();var s=e(this).closest(".panel"),l=s.find(".panel-wrapper");l.collapse("toggle")}),e(s).on("click",o,function(i){function l(){var i=s.parent();s.remove(),i.filter(function(){return e(this).is('[class*="col-"]')&&0===e(this).children("*").length}).remove()}i.preventDefault();var s=e(this).closest(".panel");l()})}(jQuery,window,document),$(function(){$('[data-toggle="tooltip"]').tooltip()}),$(function(){$('[data-toggle="popover"]').popover()}),$(".list-task li label").on("click",function(){$(this).toggleClass("task-done")}),$(".settings_box a").on("click",function(){$("ul.theme_color").toggleClass("theme_block")}),$(".collapseble").on("click",function(){$(".collapseblebox").fadeToggle(350)}),$(".slimscrollright").slimScroll({height:"100%",position:"right",size:"5px",color:"#dcdcdc"}),$(".slimscrollsidebar").slimScroll({height:"100%",position:"right",size:"5px",color:"#dcdcdc"}),$(".chat-list").slimScroll({height:"100%",position:"right",size:"5px",color:"#dcdcdc"}),e.trigger("resize"),$(".visited li a").on("click",function(e){$(".visited li").removeClass("active");var i=$(this).parent();i.hasClass("active")||i.addClass("active"),e.preventDefault()}),$("#to-recover").on("click",function(){$("#loginform").slideUp(),$("#recoverform").fadeIn()}),$(".navbar-toggle").on("click",function(){$(".navbar-toggle i").toggleClass("ti-menu").addClass("ti-close")});

//$("#division").load(base_url + '/fetchDivision');
//console.log(site_url);
var urlstr = base_url + 'fetchDivision';
var url = urlstr.replace("undefined","");
//var url = $("#base_url").val();
$('#division').load(url, function() {
 	
}); // /.fetching the selected class's section date					


   


});







var urlstr = base_url + 'fetchMember';
var url = urlstr.replace("undefined","");
//console.log('Test ' + url);







function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#image_upload_preview').attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]);
        }
    }

    $("#inputFile").change(function () {
        readURL(this);
    });

 function dob_handler(e){
 // alert(e.target.value);
  var today = new Date();
var curr_date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
//alert(curr_date);
const date1 = new Date(e.target.value);
const date2 = new Date(curr_date);
const diffTime = Math.abs(date2.getTime() - date1.getTime());
const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
//console.log(diffDays);
//alert(diffDays);
var age= diffDays/365;
$('#age').val(parseInt(age)+' Years Old');

}
function doj_handler(e){
//  alert(e.target.value);
  var today = new Date();
var curr_date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
//alert(curr_date);
const date1 = new Date(e.target.value);
const date2 = new Date(curr_date);
const diffTime = Math.abs(date2.getTime() - date1.getTime());
const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
//console.log(diffDays);
//alert(diffDays);
var nys= diffDays/365;
$('#nys').val(parseInt(nys)+' Years of service');


}



$("#division").unbind('change').bind('change', function() {
	var division_id = $(this).val();
var urlstr = base_url + 'fetchsubDivision';
var url = urlstr.replace("undefined","");
//console.log(url);
	$("#subdivision").load(url+'/'+division_id);
}); // .change in section

$("#subdivision").unbind('change').bind('change', function() {
	var sdivision_id = $(this).val();
var urlstr = base_url + 'fetchDepartment';
var url = urlstr.replace("undefined","");

	$("#department").load(url+'/'+sdivision_id);
}); // .change in section


$("#department").unbind('change').bind('change', function() {
	var dept_id = $(this).val();
var urlstr = base_url + 'fetchSection';
var url = urlstr.replace("undefined","");

	$("#section").load(url+'/'+dept_id);
}); // .change in section


$("#section").unbind('change').bind('change', function() {
	var section_id = $(this).val();
var urlstr = base_url + 'fetchDesignation';
var url = urlstr.replace("undefined","");

	$("#designation").load(url+'/'+section_id);
}); // .change in section






$('#suretyname').on('change', function(){
var urlstr = base_url + 'fetchMemberId';
var url = urlstr.replace("undefined","");
    
        //alert('Test');
	var itnm = $(this).val();
//	console.log(itnm + url);
	var results = [];
    $.ajax({
		url: url,
		method:"POST",
		data:{ itemkeyword: itnm },
		//dataType:"json",
		success:function (response) 
		{
			console.log(response);
 var len = response.length;
$.map(JSON.parse(response),function(items){
	//console.log(items['hsn_sac']);
	//var hsnsac = items['hsn_sac'];
	//alert(count+hsnsac);
	//document.getElementById('hsnsacName'+count).value = hsnsac;
//console.log(items['member_id']);
	$('#surety_id').val(items['member_id']);
//document.getElementById('hsnsacName'+count).value = items['hsn_sac'];
});

		}
	})        
    });



function editDemand(id = null) 
{
    if(id) {
//        console.log('Demand Id# '+id);
  //  $("#editCustomerTable tbody tr").remove();

        //console.log(id);
 var urlstr = base_url + 'fetchDemandById';
 var url = urlstr.replace("undefined","");


//var furl;
//var custid = id ;
//  furl = "invoice/fetchCustomerDataForUpdate/";

 
        $.ajax({
            url: url+"?id="+ id, //'invoice/fetchCustomerDataForUpdate/'+id, //base_url + furl,data: {"custid": custid}, //'invoice/fetchInvoiceDataForUpdate/'+invNo,
                      
            success:function(response) {
  //  console.log(response);
            
            $("#show-edit-demand-result").html(response);
           // $("#edit-demand-result").show();
            $('#edit-demand-modal').modal('show'); 
 var $outp = response;          
                
            } // /success
        }); // /.ajax
    } // /.if
} // /.update epxense function




    $("#editDemandForm").unbind('submit').bind('submit', function(e) {
    	e.preventDefault();
        var form = $(this);
//        var url = form.attr('action');
        var type = form.attr('method');
var urlstr = base_url + 'updateDemand';
 var url = urlstr.replace("undefined","");

/*var formdata =  form.serialize();
console.log(formdata);
console.log(url);

$.post(url,formdata,function(data) {
   console.log(data);
   //list_politic();
if(data.success == true) {                      
                        $("#upd-demand-message").html('<div class="alert alert-success alert-dismissible" role="alert">'+
                          '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+
                          response.messages + 
                        '</div>');
}

});
*/
        $.ajax({
            url: url,
            type: type,
            data: form.serialize(),
            dataType: 'json',
            success:function(response) {
            console.log(response);
$('#edit-demand-modal').modal('hide'); 
                if(response.success == true) {                      
                        $("#upd-demand-message").html('<div class="alert alert-success alert-dismissible" role="alert">'+
                          '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+
                          response.messages + 
                        '</div>');

/*
  
$("#upd-demand-message").fadeTo(2000, 500).slideUp(500, function(){
    $("#success-alert").slideUp(500);


//$("#editDemandForm").trigger("reset");
});

*/

manageDemandTable.ajax.reload(null,false);

//setTimeout(function(){// wait for 5 secs(2)
  //         location.reload(); // then reload the page.(3)
  //  }, 500); 

                      //  $("#addSalesInvoiceTable:not(:first)").remove();
                       // $('.form-group').removeClass('has-error').removeClass('has-success');
                       // $('.text-danger').remove();     
                        //addSalesInvoiceTable.ajax.reload(null,false);
                      //  manageInvoiceTable.ajax.reload(null, false);
                      //  getInvoiceno();

                      //  $("#createInvoiceForm")[0].reset();             
                      //  $(".appended-exp-row").remove();
                    }   
                    else {                                  
                        
                        $.each(response.messages, function(index, value) {
                            var key = $("#" + index);

                            key.closest('.form-group')
                            .removeClass('has-error')
                            .removeClass('has-success')
                            .addClass(value.length > 0 ? 'has-error' : 'has-success')
                            .find('.text-danger').remove();                         

                            key.after(value);
                        });
                                                
                    } // /else
            } // /.success
        });  // /.ajax funciton
        return false;
  









    });

